version: '3.3'

services:
  db-stockd:
    container_name: db-stockd
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_DATABASE=stockd
      - MYSQL_PASSWORD=stockd
      - MYSQL_USER=stockd
    image: mariadb
    ports:
      - '3308:3306'
    volumes:
      - ./api/db:/tmp/db
    command: mysqld --init-file="/tmp/db/stockd.sql"

  api-stockd:
    build: ./api
    container_name: api-stockd
    depends_on:
      - db-stockd
    ports:
      - '8000:8080'
    user: www-data
    volumes:
      - ./api/:/var/www/html/

  web-stockd:
    build: ./web
    container_name: web-stockd
    depends_on:
      - api-stockd
    ports:
      - '8080:3000'
    volumes:
      - ./web/:/usr/src/app
    environment:
      - NODE_ENV=development
      - CHOKIDAR_USEPOLLING=true
